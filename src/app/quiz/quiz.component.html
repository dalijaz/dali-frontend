<div class="quiz-shell">
  <!-- Header -->
  <div class="quiz-header">
    <div class="left">
      <span class="dot"></span>
      <strong>Quiz</strong>
    </div>
    <div class="right">
      <span class="pill">Time Left: {{ formatTime(remainingSeconds) }}</span>
      <span class="pill">Questions {{ questions.length }}</span>
      <button class="btn btn-outline-danger btn-sm" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Alert states -->
  <div *ngIf="loadError" class="alert alert-danger">{{ loadError }}</div>
  <div *ngIf="submitError" class="alert alert-danger">{{ submitError }}</div>
  <div *ngIf="loading" class="muted">Loading…</div>

  <!-- Quiz Form -->
  <form
    *ngIf="!loading && !loadError && questions.length"
    [formGroup]="form"
    (ngSubmit)="submit()"
    class="quiz-form"
  >
    <div class="question-card" *ngFor="let q of questions; let i = index">
      <div class="q-head">
        <h5>Q{{ i + 1 }}. {{ q.text }}</h5>
        <small *ngIf="q.mark" class="pts">{{ q.mark }} pts</small>
      </div>

      <!-- MCQ -->
      <div *ngIf="q.options?.length" class="options">
        <label class="option" *ngFor="let opt of q.options; let j = index">
          <input
            type="radio"
            [value]="j"
            [formControl]="selectionsFA.at(i)"
            [name]="'question' + i"
          />
          <span class="option-letter">{{ getLetter(j) }}.</span>
          <span class="option-text">{{ opt }}</span>
        </label>
      </div>

      <!-- Open text -->
      <div *ngIf="!q.options?.length">
        <textarea
          class="form-control"
          rows="3"
          placeholder="Votre réponse…"
          [formControl]="textAnswersFA.at(i)"
        ></textarea>
      </div>
    </div>

    <!-- Submit (right-aligned) -->
    <div class="submit-row">
      <button class="btn btn-primary" type="submit" [disabled]="submitting">
        {{ submitting ? 'Submitting…' : 'Submit' }}
      </button>
    </div>
  </form>
</div>
