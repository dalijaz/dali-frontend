<div class="admin-root">
  <div class="admin-scope shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <span class="dot"></span>
        <span class="name">Admin</span>
      </div>

      <nav class="nav">
        <div class="item active">Certificates</div>
        <a class="item" routerLink="/admin/questions">Questions</a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <h1 class="title strong-title">Certificates (Admin)</h1>
        <div class="spacer"></div>

        <input class="search" placeholder="Name" [(ngModel)]="name" name="newName" />
        <input class="search" placeholder="Description" [(ngModel)]="description" name="newDesc" />
        <button class="btn" (click)="create()">Create</button>
      </div>

      <div *ngIf="error" class="panel error-panel">
        <div class="panel-title">Error</div>
        <div class="text-danger">{{ error }}</div>
      </div>

      <!-- KPIs -->
      <section class="kpis">
        <div class="kpi"><div class="label">Total Certificates</div><div class="value">{{ totalCount }}</div></div>
        <div class="kpi"><div class="label">With Timer</div><div class="value">{{ timedCount }}</div></div>
        <div class="kpi"><div class="label">No Timer</div><div class="value">{{ noTimerCount }}</div></div>
        <div class="kpi"><div class="label">Attempts (7d)</div><div class="value">{{ attempts7d }}</div></div>
      </section>

      <!-- List -->
      <section class="panel">
        <h3 class="panel-title">List</h3>

        <ng-template #empty>
          <div class="empty">No certificates yet.</div>
        </ng-template>

        <table class="table" *ngIf="certs?.length; else empty">
          <thead>
            <tr>
              <th style="width:22%">Name</th>
              <th style="width:38%">Description</th>
              <th style="width:20%">Quiz Time</th>
              <th style="width:20%"></th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let c of certs">
              <!-- Normal row -->
              <tr *ngIf="editing !== c.id; else editRow">
                <td><strong>{{ c.name }}</strong></td>
                <td>{{ c.description }}</td>
                <td>
                  <ng-container *ngIf="c.durationSeconds as s; else notset">
                    <span class="badge">{{ (s / 60) | number:'1.0-0' }} min ({{ s }} s)</span>
                  </ng-container>
                  <ng-template #notset><span class="badge">not set</span></ng-template>
                </td>
                <td class="row-actions">
                  <button class="btn small" (click)="startEdit(c)">Edit</button>
                  <button class="btn small danger" (click)="remove(c.id!)">Delete</button>
                  <button class="btn small" (click)="startEditTime(c)">Edit Time</button>
                  <a class="btn small ghost" [routerLink]="['/admin/certificates', c.id, 'questions']">Edit Questions</a>
                </td>
              </tr>

              <!-- Separate time editor row -->
              <tr *ngIf="editingTime === c.id">
                <td colspan="4">
                  <div class="time-row">
                    <label>Time (minutes):</label>
                    <input class="input small-input" type="number" min="1"
                           [(ngModel)]="timeMinutes" name="minutes{{c.id}}" />
                    <button class="btn small" (click)="saveTime(c.id!)"
                            [disabled]="!timeMinutes || timeMinutes < 1">Save</button>
                    <button class="btn small ghost" (click)="cancelEditTime()">Cancel</button>
                  </div>
                </td>
              </tr>

              <!-- Edit name/desc row -->
              <ng-template #editRow>
                <tr>
                  <td colspan="4">
                    <div class="edit-row">
                      <input class="input" [(ngModel)]="editName" name="editName{{c.id}}" placeholder="Name" />
                      <input class="input" [(ngModel)]="editDescription" name="editDesc{{c.id}}" placeholder="Description" />
                      <button class="btn small" (click)="save(c.id!)">Save</button>
                      <button class="btn small ghost" (click)="cancel()">Cancel</button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </ng-container>
          </tbody>
        </table>
      </section>

      <div style="margin-top:14px">
        <button class="btn ghost" style="width:100%" (click)="logout()">Logout</button>
      </div>
    </main>
  </div>
</div>
